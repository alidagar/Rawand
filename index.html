<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rawand Optical | Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <link rel="apple-touch-icon" href="https://assets.softr-files.com/applications/1332b07e-2803-4ca2-961e-48de84f7f376/assets/c34235fe-b50f-4223-af79-8554e3437b9f.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; }
        .active-tab { background-color: #063356 !important; color: white !important; shadow: 0 4px 12px rgba(6, 51, 86, 0.3); }
        .lens-card { transition: all 0.2s ease; border-radius: 1.5rem; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-10">

    <header class="bg-white sticky top-0 z-50 border-b border-gray-200 p-4 shadow-sm">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <img src="https://assets.softr-files.com/applications/1332b07e-2803-4ca2-961e-48de84f7f376/assets/c5680a02-6638-4d63-9827-84c7e087b62b.png" class="h-10">
            <div class="text-left">
                <h1 class="text-xl font-black text-[#063356]">RAWAND</h1>
                <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">Price List</p>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 mt-6">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ (Ø§Ø³Ù…ØŒ Ø³Ø¹Ø±ØŒ Ù†ÙˆØ¹)..." 
            class="w-full p-4 rounded-2xl shadow-lg border-none mb-6 text-right outline-none focus:ring-2 focus:ring-[#063356]">

        <div id="tabsContainer" class="flex gap-2 overflow-x-auto pb-4 no-scrollbar mb-6">
            </div>

        <div id="cardsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-right">
            </div>
    </main>

<script>
    const sheetId = '11rfaJLxUx5CIc_znlntQ3udyqPujSAPXFFRFjAsePlk';
    // Ø§Ù„ØªØ§Ø¨Ø§Øª ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ Ù…Ù„ÙÙƒ Ø¨Ø§Ù„Ø¶Ø¨Ø·
    const tabs = ['Zeiss', 'Hoya', 'Nova', 'Divel', 'Synchrony', 'Local Lenses', 'Contact Lenses'];
    
    let currentData = [];

    async function fetchSheetData(tabName) {
        const grid = document.getElementById('cardsGrid');
        grid.innerHTML = '<div class="col-span-full text-center py-20 text-gray-400 font-bold animate-pulse">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© ' + tabName + '...</div>';
        
        // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙƒÙŠ Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© JSON
        const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&tq=select%20*&sheet=${encodeURIComponent(tabName)}`;
        
        try {
            const response = await fetch(url);
            const text = await response.text();
            const json = JSON.parse(text.substring(47, text.length - 2));
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„ØµÙÙˆÙ
            const headers = json.table.cols.map(c => c.label || "Info");
            const data = json.table.rows.map(r => {
                let obj = {};
                r.c.forEach((cell, i) => {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙØ§Ø±ØºØ§Ù‹ ÙÙŠ Ø§Ù„Ø´ÙŠØª Ø³Ù†Ø³Ù…ÙŠÙ‡ Ø­Ø³Ø¨ Ù…ÙˆÙ‚Ø¹Ù‡
                    const key = headers[i] || `col_${i}`;
                    obj[key] = cell ? (cell.v || cell.f || "") : "";
                });
                return obj;
            });

            currentData = data;
            renderCards(data);
        } catch (e) {
            grid.innerHTML = '<div class="col-span-full text-center py-20 text-red-500">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø´Ø± Ø§Ù„Ø´ÙŠØª (Publish to web).</div>';
        }
    }

    function renderCards(data) {
        const grid = document.getElementById('cardsGrid');
        if (!data || data.length === 0) {
            grid.innerHTML = '<div class="col-span-full text-center py-20 text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</div>';
            return;
        }

        grid.innerHTML = data.map(item => {
            const keys = Object.keys(item);
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø¹Ø± Ø°ÙƒÙŠØ§Ù‹: Ø£ÙˆÙ„ Ø¹Ù…ÙˆØ¯ ÙŠØ­ØªÙˆÙŠ Ø±Ù‚Ù…Ø§Ù‹ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø³Ø¹Ø±
            const priceKey = keys.find(k => k.includes('Ø³Ø¹Ø±') || k.toLowerCase().includes('price')) || keys[1];
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø³Ù…: Ø£ÙˆÙ„ Ø¹Ù…ÙˆØ¯ ØºØ§Ù„Ø¨Ø§Ù‹
            const nameKey = keys.find(k => k.includes('Ù†ÙˆØ¹') || k.includes('Ø§Ø³Ù…') || k.toLowerCase().includes('name') || k.includes('Brand')) || keys[0];

            return `
                <div class="lens-card bg-white p-6 shadow-sm border border-white hover:shadow-xl transition-all flex flex-col justify-between">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-extrabold text-[#063356] leading-tight">${item[nameKey]}</h3>
                        <div class="bg-blue-50 text-[#063356] px-3 py-1 rounded-xl font-black text-sm whitespace-nowrap mr-2">
                            ${item[priceKey]} <span class="text-[10px]">JOD</span>
                        </div>
                    </div>
                    <div class="space-y-2 border-t pt-3 mt-auto">
                        ${keys.filter(k => k !== priceKey && k !== nameKey && item[k]).map(k => `
                            <div class="flex justify-between text-[11px]">
                                <span class="text-gray-400 font-medium">${k}:</span>
                                <span class="text-gray-700 font-bold">${item[k]}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ§Ø¨Ø§Øª
    const tabsContainer = document.getElementById('tabsContainer');
    tabs.forEach((tab, index) => {
        const btn = document.createElement('button');
        btn.innerText = tab === 'Contact Lenses' ? 'Ø¹Ø¯Ø³Ø§Øª Ù„Ø§ØµÙ‚Ø© ğŸ‘ï¸' : tab;
        btn.className = `brand-btn whitespace-nowrap px-6 py-2 rounded-full border-2 border-gray-100 font-bold text-sm transition-all ${index === 0 ? 'active-tab' : 'bg-white text-gray-500 hover:border-[#063356]'}`;
        btn.onclick = () => {
            document.querySelectorAll('.brand-btn').forEach(b => b.classList.remove('active-tab'));
            btn.classList.add('active-tab');
            fetchSheetData(tab);
        };
        tabsContainer.appendChild(btn);
    });

    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ
    document.getElementById('searchInput').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = currentData.filter(row => 
            Object.values(row).some(val => String(val).toLowerCase().includes(term))
        );
        renderCards(filtered);
    });

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ ØªØ§Ø¨Ø©
    fetchSheetData(tabs[0]);
</script>
</body>
</html>
